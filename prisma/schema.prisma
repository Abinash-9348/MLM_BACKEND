generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"

}

// =======================
// Enums
// =======================

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum MemberIdGeneration {
  RANDOM
  SEQUENCE
}

enum FileStorageMode {
  LOCAL
  S3
}

enum CategoryStatus {
  INACTIVE @map("0")
  ACTIVE   @map("1")
}

// =======================
// Models
// =======================

model Counter {
  id     Int @id @default(autoincrement())
  userId Int @default(100000) // starting userId
}

model User {
  id     Int @id @default(autoincrement())
  userId Int @unique

  fname String
  mname String
  lname String

  country_code String
  mobile1      String
  mobile2      String

  email    String @unique
  password String

  age    Int
  gender String

  purchese_plan     Int?
  total_purchese_bv Int?
  total_user_bv     Int?
  total_bv          Int?

  profile_img String?
  pin_code    Int
  city        String
  state       String

  memId   String
  upline  String?
  sponser String?

  left_leg  Int?
  right_leg Int?

  myjoinig Int[] @default([])

  status  UserStatus @default(ACTIVE)
  isBlock Int        @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy Int?
  updatedBy Int?
}

model GeneralSettings {
  id               Int    @id @default(autoincrement())
  dateformat       String
  currencySymbol   String
  timeZone         String
  allowedFileTypes String
  maxFileSizeMB    Int

  fileStorageMode FileStorageMode

  localFilePath String?
  s3Bucket      String?
  s3Folder      String?

  maxPlanCreation   Int
  multiBinaryEnable String @default("Y")

  memberIdGeneration MemberIdGeneration @default(RANDOM)

  minDirectSponsorsForWithdrawal Int
  minBVForWithdrawal             Int

  incomeGenerationMode String
  dailyCycleStart      String?
  dailyCycleEnd        String?

  weeklyCycleStartDay  String?
  weeklyCycleStartTime String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Company {
  id              Int       @id @default(autoincrement())
  
  companyName     String?
  websiteUrl      String?
  printName       String?
  billPrefix      String?          

  beginningDate   DateTime?
  commencingFrom  DateTime?

  addressLine1    String?
  addressLine2    String?

  country         String?
  state           String?

  contactNo1      String?
  contactNo2      String?

  email           String? @unique
  website         String?

  gstNo           String?
  panNo           String?
  vatNo           String?
  fax             String?

  lightLogo       String?        
  darkLogo        String?     

  plans           Plan[]
  admins          Admin[] 

  createdBy  String?
  updatedBy  String?

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([companyName])
  @@index([email])
  @@index([gstNo])
}

model Plan {
  id Int  @id @default(autoincrement())
  companyId Int? 
  company   Company? @relation(fields: [companyId], references: [id])
  name      String?
  price     Float?
  BV        Float?
  description Json?
  isActive  Boolean?
  tax       String?
  config    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Admin {
  id                  Int       @id @default(autoincrement())
  companyId           Int?
  company             Company?  @relation(fields: [companyId], references: [id])
  
  firstname           String?
  lastname            String?
  email               String?   @unique

  countrycode         String?
  mobno1              String?
  mobno2              String?

  pinno               String?
  countryname         String?
  statename           String?
  address             String?

  password            String?
  profileimg          String?
  admintype           String?

  walletbalance       Float @default(0)
  totalwalletadd      Float @default(0)
  totalwithdraw       Float @default(0)
  totaltransferwallet Float @default(0)

  status              Boolean @default(true)

  createdBy           String?
  updatedBy           String?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  sessions            AdminSession[]
  categoriesCreated   Category[] @relation("CreatedCategories")
  categoriesUpdated   Category[] @relation("UpdatedCategories")

  @@index([companyId])
  @@index([status])
  @@index([admintype])
}

model AdminSession {
  id        Int      @id @default(autoincrement())
  adminId   Int
  admin     Admin    @relation(fields: [adminId], references: [id])
  userAgent String?
  ipAddress String?
  valid     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          Int           @id @default(autoincrement())
  name        String
  status      CategoryStatus @default(ACTIVE)

  createdById Int?
  createdBy   Admin?         @relation("CreatedCategories", fields: [createdById], references: [id])

  updatedById Int?
  updatedBy   Admin?         @relation("UpdatedCategories", fields: [updatedById], references: [id])

  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([name])
  @@index([status])
}
